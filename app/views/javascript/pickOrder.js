$.get('/api/orders/active/', function (data) {
  // mock data for ui design
  data = {
    "1926312260": [
      {
        "id": 1,
        "item": "Apple Pie",
        "price": 0,
        "quantity": 1,
        "orderNumber": 1926312260,
        "shopper": "none",
        "status": "ordered",
        "createdAt": "2019-01-06T22:01:28.000Z",
        "updatedAt": "2019-01-06T22:01:57.000Z",
        "DemoId": null,
        "username": "jblue@ymail.com",
        "Demo": {
          "id": 1,
          "firstName": "Jess",
          "lastName": "Blue",
          "imageUrl": "https://www.google.com/imgres?imgurl=https%3A%2F%2Fwww.trbimg.com%2Fimg-5a16fd9f%2Fturbine%2Fsc-fam-changing-beauty-people-1128&imgrefurl=https%3A%2F%2Fwww.chicagotribune.com%2Flifestyles%2Fsc-fam-changing-beauty-people-1128-story.html&docid=P3hHhi6J1bqCz",
          "phone": 960356456,
          "address": "22 West Elm St., Chicago, IL",
          "activeuser": true,
          "UserEmail": "jblue@ymail.com",
          "username": "jblue@ymail.com",
          "createdAt": "2019-01-06T22:01:14.000Z",
          "updatedAt": "2019-01-06T22:01:14.000Z"
        }
      },
      {
        "id": 2,
        "item": "Apple Crepes",
        "price": 0,
        "quantity": 1,
        "orderNumber": 1926312260,
        "shopper": "none",
        "status": "ordered",
        "createdAt": "2019-01-06T22:01:29.000Z",
        "updatedAt": "2019-01-06T22:01:57.000Z",
        "DemoId": null,
        "username": "jblue@ymail.com",
        "Demo": {
          "id": 1,
          "firstName": "Jess",
          "lastName": "Blue",
          "imageUrl": "https://www.google.com/imgres?imgurl=https%3A%2F%2Fwww.trbimg.com%2Fimg-5a16fd9f%2Fturbine%2Fsc-fam-changing-beauty-people-1128&imgrefurl=https%3A%2F%2Fwww.chicagotribune.com%2Flifestyles%2Fsc-fam-changing-beauty-people-1128-story.html&docid=P3hHhi6J1bqCz",
          "phone": 960356456,
          "address": "22 West Elm St., Chicago, IL",
          "activeuser": true,
          "UserEmail": "jblue@ymail.com",
          "username": "jblue@ymail.com",
          "createdAt": "2019-01-06T22:01:14.000Z",
          "updatedAt": "2019-01-06T22:01:14.000Z"
        }
      },
      {
        "id": 3,
        "item": "Apple Cake",
        "price": 0,
        "quantity": 1,
        "orderNumber": 1926312260,
        "shopper": "none",
        "status": "ordered",
        "createdAt": "2019-01-06T22:01:30.000Z",
        "updatedAt": "2019-01-06T22:01:57.000Z",
        "DemoId": null,
        "username": "jblue@ymail.com",
        "Demo": {
          "id": 1,
          "firstName": "Jess",
          "lastName": "Blue",
          "imageUrl": "https://www.google.com/imgres?imgurl=https%3A%2F%2Fwww.trbimg.com%2Fimg-5a16fd9f%2Fturbine%2Fsc-fam-changing-beauty-people-1128&imgrefurl=https%3A%2F%2Fwww.chicagotribune.com%2Flifestyles%2Fsc-fam-changing-beauty-people-1128-story.html&docid=P3hHhi6J1bqCz",
          "phone": 960356456,
          "address": "22 West Elm St., Chicago, IL",
          "activeuser": true,
          "UserEmail": "jblue@ymail.com",
          "username": "jblue@ymail.com",
          "createdAt": "2019-01-06T22:01:14.000Z",
          "updatedAt": "2019-01-06T22:01:14.000Z"
        }
      },
      {
        "id": 4,
        "item": "apple",
        "price": 2.4,
        "quantity": 1,
        "orderNumber": 1926312260,
        "shopper": "none",
        "status": "ordered",
        "createdAt": "2019-01-06T22:01:45.000Z",
        "updatedAt": "2019-01-06T22:01:57.000Z",
        "DemoId": null,
        "username": "jblue@ymail.com",
        "Demo": {
          "id": 1,
          "firstName": "Jess",
          "lastName": "Blue",
          "imageUrl": "https://www.google.com/imgres?imgurl=https%3A%2F%2Fwww.trbimg.com%2Fimg-5a16fd9f%2Fturbine%2Fsc-fam-changing-beauty-people-1128&imgrefurl=https%3A%2F%2Fwww.chicagotribune.com%2Flifestyles%2Fsc-fam-changing-beauty-people-1128-story.html&docid=P3hHhi6J1bqCz",
          "phone": 960356456,
          "address": "22 West Elm St., Chicago, IL",
          "activeuser": true,
          "UserEmail": "jblue@ymail.com",
          "username": "jblue@ymail.com",
          "createdAt": "2019-01-06T22:01:14.000Z",
          "updatedAt": "2019-01-06T22:01:14.000Z"
        }
      }
    ],
    "2147483647": [
      {
        "id": 5,
        "item": "apple",
        "price": 2.4,
        "quantity": 1,
        "orderNumber": 2147483647,
        "shopper": "none",
        "status": "ordered",
        "createdAt": "2019-01-06T22:02:01.000Z",
        "updatedAt": "2019-01-06T22:02:06.000Z",
        "DemoId": null,
        "username": "jblue@ymail.com",
        "Demo": {
          "id": 1,
          "firstName": "Jess",
          "lastName": "Blue",
          "imageUrl": "https://www.google.com/imgres?imgurl=https%3A%2F%2Fwww.trbimg.com%2Fimg-5a16fd9f%2Fturbine%2Fsc-fam-changing-beauty-people-1128&imgrefurl=https%3A%2F%2Fwww.chicagotribune.com%2Flifestyles%2Fsc-fam-changing-beauty-people-1128-story.html&docid=P3hHhi6J1bqCz",
          "phone": 960356456,
          "address": "22 West Elm St., Chicago, IL",
          "activeuser": true,
          "UserEmail": "jblue@ymail.com",
          "username": "jblue@ymail.com",
          "createdAt": "2019-01-06T22:01:14.000Z",
          "updatedAt": "2019-01-06T22:01:14.000Z"
        }
      }
    ]
  }
  renderCarousel(data);
});

var globalData;

function renderCarousel(data) {
  console.log(data);
  // store data in a global var for later
  globalData = data;
  // Make a new card for carousel for each order
  for (let order in data) {
    // create newDiv for each data Point
    let newDiv = $("<div>");
    newDiv.addClass("carousel-item red white-text");
    newDiv.attr("href", '#no');
    // add orderNumber for lookup later
    newDiv.attr("data-orderNumber", order);
    // Give header
    let newHeader = $("<h2>")
    newHeader.html(order);
    newDiv.append(newHeader);
    // create list of items to purchase
    let newUl = $("<ul>");
    data[order].map(item => {
      let newLi = $("<li>");
      newLi.html(`${item.item} : ${item.quantity}`);
      newUl.append(newLi);
    });
    newDiv.append(newUl);
    $(".carousel").append(newDiv);
  }
  // initialize carousel so it moves
  var instance = M.Carousel.init({
    fullWidth: true,
    indicators: true
  });
  var slider = $('.carousel');
  slider.carousel();

  // initialize modal
  $('.modal').modal();
}

function prepareModal(orderNum) {
  // empty modal
  let modalCont = $('.modal-content');
  modalCont.empty();
  // header
  let header = $('<h4>');
  header.attr("id", "order-details-modal-header");
  header.html(`Order Number: ${orderNum}`);
  modalCont.append(header);
  // grab relevant order data
  let dataToShow = globalData[orderNum];
  // create list of items
  let newUl = $('<ul>');
  dataToShow.map(dataToShow => {
    let newLi = $('<li>');
    newLi.html(`${dataToShow.item} : ${dataToShow.quantity}`);
    newUl.append(newLi);
  });
  modalCont.append(newUl);
}

// grab the div with .active for the button then render a model
$('#details-btn').on('click', function (e) {
  let activeOrder = $('.active').attr('data-orderNumber');
  prepareModal(activeOrder);
  let modal = $(".modal");
  // carousel doesn't play nice with modals, have to manual call open()
  var instance = M.Modal.getInstance(modal);
  instance.open();
});